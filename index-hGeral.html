<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./styles/index.css" >
  <title>Uploadfile</title>
</head>
<body>
  <h1>História Geral</h1><br>
  Nome completo: <input type="text" required="" name="nomeAluno" id="nomeAluno"><br><br><hr>
<form name="form"> 
  <p>Qual sua série:</p>
  <input type="radio" name="serie" id="6" value="6">
  <label for="">6</label><br><br>

  <input type="radio" name="serie" id="7" value="7">
  <label for="">7</label><br><br>

  <input type="radio" name="serie" id="8" value="8">
  <label for="">8</label><br><br>
</form>
<hr>
<form name="form-turma">
  <p>Qual sua turma:</p>
  <input type="radio" name="turma" id="A" value="A">
  <label for="">A</label><br>

  <input type="radio" name="turma" id="B" value="B">
  <label for="">B</label><br>

  <input type="radio" name="turma" id="C" value="C">
  <label for="">C</label><br>

  <input type="radio" name="turma" id="D" value="D">
  <label for="">D</label><br>

  <input type="radio" name="turma" id="E" value="E">
  <label for="">E</label><br>

  <input type="radio" name="turma" id="F" value="F">
  <label for="">F</label><br><br><hr>
</form> 


  <!-- TAREFAS MÊS DE ABRIL -->
<div id="render6">
  <!-- Título das tarefas  6 ANO-->
  <label for="tarefa">6 ANO | Escolha a atividade:</label>
  <select name="tarefa" id="tarefa">
    <option value="06.04.2021">Abril - Semana 1</option>
     <option value="13.04.2021">Abril - Semana 2</option>
     <option value="21.04.2021">Abril - Semana 3</option>
     <option value="24.04.2021">Abril - Semana 4</option>
     <option value="28.04.2021">Jogo Labirinto</option>
     <option value="Maio - 1">Maio - Semana 1</option>
     <option value="Maio - 2">Maio - Semana 2</option>
     <option value="Maio - 3">Maio - Semana 3</option>
     <option value="Maio - 4">Maio - Semana 4</option>
  </select><br><br><br>
</div>

   <!-- Título das tarefas 7 ANO-->
   <div id="render7">
    <label for="tarefa">7 ANO | Escolha a atividade:</label>
    <select name="tarefa" id="tarefa">
     <option value="06.04.2021">Abril - Semana 1</option>
     <option value="13.04.2021">Abril - Semana 2</option>
     <option value="21.04.2021">Abril - Semana 3</option>
     <option value="24.04.2021">Abril - Semana 4</option>
     <option value="28.04.2021">Jogo Labirinto</option>
     <option value="Maio - 1">Maio - Semana 1</option>
     <option value="Maio - 2">Maio - Semana 2</option>
     <option value="Maio - 3">Maio - Semana 3</option>
     <option value="Maio - 4">Maio - Semana 4</option>
    </select><br><br><br>
   </div>
    
 
   <!-- Título das tarefas  8 ANO-->
   <div id="render8">
   <label for="tarefa">8 ANO | Escolha a atividade:</label>
   <select name="tarefa" id="tarefa">
    <option value="06.04.2021">Abril - Semana 1</option>
    <option value="13.04.2021">Abril - Semana 2</option>
    <option value="21.04.2021">Abril - Semana 3</option>
    <option value="24.04.2021">Abril - Semana 4</option>
    <option value="28.04.2021">Jogo Labirinto</option>
    <option value="Maio - 1">Maio - Semana 1</option>
    <option value="Maio - 2">Maio - Semana 2</option>
    <option value="Maio - 3">Maio - Semana 3</option>
    <option value="Maio - 4">Maio - Semana 4</option>
   </select><br><br><br>
 </div>


 <script>
  // Alterando titulos de tarefas de acordo com turma de aluno ao clickar no input:radio

  document.getElementById('render6').style.display = 'none';
  document.getElementById('render7').style.display = 'none';
  document.getElementById('render8').style.display = 'none';

  var rad = document.form.serie;
  var prev = null;
  for (var i = 0; i < rad.length; i++) {
  rad[i].onclick = function() {
    qualquerFuncao(this);
  }
  };

  function qualquerFuncao(e) {
    console.log(e.value);
    //container.style.display = 'block';

    let node6 = document.getElementById("render6");
    let node7 = document.getElementById("render7");
    let node8 = document.getElementById("render8");

//----------------------------------------------------------------
    if (node6 == null) {
      console.log('Filho não existe, então restart');
      document.location.reload(true);
    }
    if (node7 == null) {
      console.log('Filho não existe, então restart');
      document.location.reload(true);
    }
    if (node8 == null) {
      console.log('Filho não existe, então restart');
      document.location.reload(true);
    }
//----------------------------------------------------------------

    if (e.value === '6') {

      document.getElementById('render6').style.display = 'block';
      
      if (node7.parentNode) {
        node7.parentNode.removeChild(node7);
      }
      if (node8.parentNode) {
        node8.parentNode.removeChild(node8);
      }
    }


    if (e.value === '7') {
      
      document.getElementById('render7').style.display = 'block';
      
      if (node6.parentNode) {
        node6.parentNode.removeChild(node6);
      }
      if (node8.parentNode) {
        node8.parentNode.removeChild(node8);
      }
    }



    if (e.value === '8') {
      
      document.getElementById('render8').style.display = 'block';
      
      if (node6.parentNode) {
        node6.parentNode.removeChild(node6);
      }
      if (node7.parentNode) {
        node7.parentNode.removeChild(node7);
      }
    }
  }
</script>


  <p>Salvar atividade aqui:</p>
  <input type="file" id="arquivoUP" onchange="__funcPasta(this)" accept=".jpg, .jpeg, .png, .svg, .gif, .txt, .pdf" multiple><br><br><hr>
<div id="botao">
  <input onclick="vai()" class="submit" type="submit" value="Enviar">
</div>


<br><br>

<!-- Esconter turma -->
<script>
  function clickArte(){
    console.log("click arte!!!");
    let container = document.querySelector('.container');
    if(container.style.display === 'block') {
      container.style.display = 'none';
    } else {
      container.style.display = 'block';
    } 
    window.location.reload()
  }
</script>

<!-- 
  Firebase SDK Snippet	
  O SDK JS do Firebase principal é sempre necessário e deve ser listado primeiro 
-->
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>

<!-- TODO: Adicionar SDKs para produtos Firebase que você deseja usar -->
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>

<script>
  // Configuração do seu applicativo da web
  // Para Firebase JS SDK v7.20.0 e posterior, measurementId é opcional
  var firebaseConfig = {
    apiKey: "AIzaSyDf6Upy1PKhszOdlals_HTR3aeSuMKW-Xo",
    authDomain: "tarefas-ff8b6.firebaseapp.com",
    projectId: "tarefas-ff8b6",
    storageBucket: "tarefas-ff8b6.appspot.com",
    messagingSenderId: "363449766280",
    appId: "1:363449766280:web:02f0283ef9f5f3eda4aa3d",
    measurementId: "G-NK5C6XF1LW"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
</script>

<script>
  // Capturando valeu do input radios
    var serie = "";
    var turma = "turma";
    let targetGlobal; 

    // Upload de imagens p/ PASTA específica
    function __funcPasta(target)
    {
      let file = target.files[0];
      file = new File([file], 'tarefa.jpg',{type:file.type});
      targetGlobal = file; 
      
      //tarefaRef.put(file).then(function(snapshot) {
      //  console.log('Upload de imagemPASTA concluido!!');
      //});
    }

    function vai(){
      let serie = document.querySelector('input[name="serie"]:checked').value;
      let turma = document.querySelector('input[name="turma"]:checked').value;
      let nomeAluno = (document.getElementById('nomeAluno').value).toUpperCase();
      console.log(`Nome do aluno(a): ${nomeAluno}`);
      console.log(`Serie: ${serie} Turma: ${turma}`);

      //<!--Referenciado nome das imagens-->
      // Criando referencia raiz
      let storage = firebase.storage();
      let storageRef = storage.ref();

      // Valor do option
      var select = document.getElementById('tarefa');
	    var value = select.options[select.selectedIndex].value;
	    console.log(`Valor do option: ${value}`);

      // Criando os filhos
      let texto = storageRef.child('Arquivo.txt');
      let imagemRef = storageRef.child('imagem-raiz.jpg');
      //let tarefaRef = storageRef.child(`Historia-Geral/${serie}/${serie}-${turma}/${value}/${nomeAluno}`);
      //console.log(`Filho tarefa: ${tarefaRef}`);

      let campoNome = document.getElementById('nomeAluno').value;
      console.log(`Valor do campo nome do Aluno: ${campoNome}`);

      // Verificar se campo Nome foi preenchido
      if (campoNome == "") {
	      console.log('Campo nome não preenchido!');
	      alert('Digite seu nome!');
        window.location.hef = "./index.hGeral.html"
      }
      // Verifique se existe um arquivo
      if (!targetGlobal) {
        console.log('Arquivo não anexado!')
        alert('Você esqueceu de anexar a tarefa!')
        window.location.hef = "./index-artes.html"
      }
       // Testando envio de varios arquivos simultaneos
       console.log('Iniciando teste upload mult...')
      let fileInput = document.getElementById('arquivoUP')
      let arquivos = fileInput.files
      let arq
      console.log(arquivos)
      
      for (var i=0; i < arquivos.length; i++){
        //obter o item 
        arq = arquivos[i]

        // Criando filhos [teste]
        let tarefaRef = storageRef.child(`Historia-Geral/${serie}/${serie}-${turma}/${value}/${nomeAluno}-${arq.name}`);

        console.log(`Nome do arquivo: ${arq.name}`)

        // Enviado dados para Firebase
        if (campoNome != "" && (!targetGlobal === false)) {
          console.log(targetGlobal);
          tarefaRef.put(arq).then(function(snapshot){
            console.log('Tarefa de Artes enviada!');
          })  
        }
      }
      if (arquivos[arquivos.length-1]){
        setTimeout(function(){ 
          alert("Obrigado querido aluno(a)! \nBreve irei corrigir!"); 
        }, 3500);
      }
    }

// Criando os filhos
//var texto = storageRef.child('Arquivo.txt');
//var imagemRef = storageRef.child('imagem-raiz.jpg');
//let tarefaRef = storageRef.child(`${serie}/${serie}-${turma}/tarefa.jpg`);
//console.log(`Filho tarefa: ${tarefaRef}`);


// Upload de textos.
function uploadTxt(){
  var message = 'Esta é a mensagem!';
  texto.putString(message).then(function(snapshot) {
    console.log('Upload .txt concluido!'); 
  });
}

// Upload de imagens na raiz
function __func(target)
{
  let file = target.files[0];
  file = new File([file], 'imagem3000.jpg',{type:file.type});
    
  imagemRef.put(file).then(function(snapshot) {
    console.log('Upload de imagem concluido!!');
  });
}



</script>
</body>
</html>
